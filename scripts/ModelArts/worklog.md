bFjYCzDZ

======================================================================
Final Score : 40214.3 GFLOPS
Final Regulated Score : 50213.6 GFLOPS
======================================================================
 Time(H)         Error(%)         Score         Regulated Score
----------------------------------------------------------------------
   0.21           96.59          38678.8          1342.4  
   0.42           71.29          39160.1         13250.8  
   0.42           71.29          39160.1         13250.8  
   0.73           71.29          34851.7         11792.9  
   0.73           71.29          34851.7         11792.9  
   0.94           71.29          36228.2         12258.7  
   1.15           71.29          37133.4         12565.0  
   1.15           71.29          37133.4         12565.0  
   1.36           71.29          37781.0         12784.1  
   1.57           70.54          38282.5         13357.7  
   1.77           68.46          38660.0         14649.1  
   1.77           68.46          38660.0         14649.1  
   1.98           66.69          38947.0         15776.1  
   2.19           66.69          39159.5         15862.1  
   2.19           66.69          39159.5         15862.1  
   2.41           64.92          39321.1         16986.8  
   2.62           64.92          39435.6         17036.3  
   2.83           63.76          39536.9         17793.1  
   2.83           63.76          39536.9         17793.1  
   3.04           63.62          39656.5         17934.1  
   3.25           63.62          39723.4         17964.4  
   3.25           63.62          39723.4         17964.4  
   3.46           59.86          39817.2         20430.6  
   3.68           59.86          39864.0         20454.6  
   3.89           59.86          39902.9         20474.6  
   3.89           59.86          39902.9         20474.6  
   4.10           57.96          39962.1         21794.3  
   4.32           57.96          39997.5         21813.5  
   4.32           57.96          39997.5         21813.5  
   4.53           55.79          40039.3         23364.6  
   4.74           55.58          40058.6         23525.6  
   4.74           55.58          40058.6         23525.6  
   4.95           53.07          40112.3         25412.7  
   5.16           53.07          40163.7         25445.3  
   5.37           51.05          40213.2         27039.2  
   5.37           51.05          40213.2         27039.2  
   5.58           47.14          40251.0         30268.0  
   5.79           45.29          40284.1         31911.5  
   5.79           45.29          40284.1         31911.5  
   6.00           44.43          40318.6         32710.3  
   6.21           40.61          40358.0         36367.8  
   6.42           37.64          40387.8         39467.3  
   6.42           37.64          40387.8         39467.3  
   6.63           33.25          40412.3         44502.7  
   6.84           28.69          40453.5         50512.2  
   6.84           28.69          40453.5         50512.2  
   7.14           28.69          39949.8         49883.3  
   7.14           28.69          39949.8         49883.3  
   7.36           28.69          39964.3         49901.4  
   7.58           28.69          39909.1         49832.6  
   7.80           28.69          39929.6         49858.2  
   7.80           28.69          39929.6         49858.2  
   8.01           28.69          39961.5         49898.0  
   8.22           28.69          40004.0         49950.9  
   8.22           28.69          40004.0         49950.9  
   8.43           28.69          40021.8         49973.3  
   8.64           28.69          40049.1         50007.4  
   8.64           28.69          40049.1         50007.4  
   8.85           28.69          40072.6         50036.7  
   9.06           28.69          40091.3         50060.0  
   9.28           28.69          40104.4         50076.3  
   9.28           28.69          40104.4         50076.3  
   9.49           28.69          40125.1         50102.2  
   9.71           28.69          40117.3         50092.4  
   9.71           28.69          40117.3         50092.4  
   9.92           28.69          40112.0         50085.9  
  10.14           28.69          40126.8         50104.4  
  10.14           28.69          40126.8         50104.4  
  10.35           28.69          40120.6         50096.6  
  10.57           28.69          40123.0         50099.6  
  10.78           28.69          40133.6         50112.8  
  10.78           28.69          40133.6         50112.8  
  10.99           28.69          40148.8         50131.9  
  11.21           28.69          40166.5         50153.9  
  11.21           28.69          40166.5         50153.9  
  11.42           28.69          40188.4         50181.3  
  11.62           28.69          40214.3         50213.6  
======================================================================

======================================================================
Final Score : q
Final Regulated Score : 49059.0 GFLOPS
======================================================================
 Time(H)         Error(%)         Score         Regulated Score
----------------------------------------------------------------------
   0.22           91.78          38579.0          3309.4  
   0.42           63.04          39160.1         18070.9  
   0.42           63.04          39160.1         18070.9  
   0.73           63.04          34050.0         15712.7  
   0.73           63.04          34050.0         15712.7  
   0.95           63.04          35107.3         16200.7  
   1.16           63.04          35868.1         16551.7  
   1.16           63.04          35868.1         16551.7  
   1.37           63.04          36356.9         16777.3  
   1.58           63.04          36733.6         16951.1  
   1.80           63.04          37015.5         17081.2  
   1.80           63.04          37015.5         17081.2  
   2.01           63.04          37253.3         17191.0  
   2.22           63.04          37455.0         17284.1  
   2.22           63.04          37455.0         17284.1  
   2.43           63.04          37613.1         17357.0  
   2.64           63.04          37722.1         17407.3  
   2.64           63.04          37722.1         17407.3  
   2.86           63.04          37829.5         17456.9  
   3.07           63.04          37932.4         17504.3  
   3.28           61.82          38012.3         18284.4  
   3.28           61.82          38012.3         18284.4  
   3.49           61.82          38085.6         18319.6  
   3.70           61.82          38164.8         18357.7  
   3.70           61.82          38164.8         18357.7  
   3.91           59.55          38216.4         19812.8  
   4.13           59.55          38267.9         19839.5  
   4.34           59.55          38307.0         19859.8  
   4.34           59.55          38307.0         19859.8  
   4.55           56.00          38344.8         22231.7  
   4.76           54.62          38386.0         23215.0  
   4.76           54.62          38386.0         23215.0  
   4.98           53.33          38406.4         24147.1  
   5.19           52.53          38429.3         24742.6  
   5.19           52.53          38429.3         24742.6  
   5.40           49.66          38458.3         26922.9  
   5.62           48.87          38487.1         27554.1  
   5.83           46.56          38508.2         29432.7  
   5.83           46.56          38508.2         29432.7  
   6.04           44.32          38538.4         31361.6  
   6.25           41.96          38582.1         33511.0  
   6.25           41.96          38582.1         33511.0  
   6.46           38.25          38594.7         37086.3  
   6.67           32.48          38614.5         43421.0  
   6.88           28.56          38647.2         48437.8  
   6.88           28.56          38647.2         48437.8  
   7.19           28.56          38196.1         47872.4  
   7.19           28.56          38196.1         47872.4  
   7.40           28.56          38278.3         47975.5  
   7.61           28.56          38358.8         48076.3  
   7.61           28.56          38358.8         48076.3  
   7.82           28.56          38441.7         48180.3  
   8.03           28.56          38520.4         48278.9  
   8.24           28.56          38593.7         48370.8  
   8.24           28.56          38593.7         48370.8  
   8.45           28.56          38667.2         48462.9  
   8.66           28.56          38728.5         48539.7  
   8.66           28.56          38728.5         48539.7  
   8.87           28.56          38779.6         48603.7  
   9.08           28.56          38841.3         48681.1  
   9.08           28.56          38841.3         48681.1  
   9.30           28.56          38864.3         48709.9  
   9.52           28.56          38886.2         48737.3  
   9.74           28.56          38891.6         48744.1  
   9.74           28.56          38891.6         48744.1  
   9.95           28.56          38936.9         48800.9  
  10.16           28.56          38982.4         48858.0  
  10.16           28.56          38982.4         48858.0  
  10.38           28.56          39016.7         48901.0  
  10.59           28.56          39053.7         48947.3  
  10.59           28.56          39053.7         48947.3  
  10.81           28.56          39080.2         48980.6  
  11.02           28.56          39106.7         49013.7  
  11.23           28.56          39142.8         49059.0  
  11.23           28.56          39142.8         49059.0  
======================================================================


(MindSpore-python3.7-aarch64) sh-4.4$python3 work/AIPerf/scripts/reportsAtlas/report.py --id d097Bj1h
======================================================================
Final Score : 337308.3 GFLOPS
Final Regulated Score : 471632.6 GFLOPS
======================================================================
 Time(H)         Error(%)         Score         Regulated Score
----------------------------------------------------------------------
   0.29           51.53          348673.4        231196.7 
   0.43           41.92          349239.1        303672.1 
   0.59           34.08          349447.7        376160.9 
   0.71           27.25          349693.0        454646.8 
   0.89           27.25          319809.1        415793.8 
   1.03           27.25          324921.1        422440.1 
   1.18           27.25          328766.8        427440.0 
   1.33           27.25          331764.9        431338.0 
   1.50           27.25          334502.0        434896.5 
   1.64           27.25          336411.9        437379.6 
   1.79           27.25          338009.8        439457.1 
   1.89           26.44          338920.8        450834.1 
   2.09           26.44          326825.6        434745.0 
   2.23           26.44          328710.2        437251.9 
   2.38           26.44          330397.5        439496.4 
   2.53           26.44          331850.0        441428.5 
   2.68           26.44          333140.9        443145.7 
   2.83           26.44          334328.6        444725.6 
   2.98           26.44          335366.4        446106.0 
   3.13           26.44          336305.2        447354.8 
   3.28           26.44          337187.1        448527.9 
   3.42           25.58          328949.2        448464.0 
   3.58           25.58          326680.9        445371.7 
   3.73           25.58          324600.1        442534.8 
   3.89           25.58          322684.2        439922.9 
   4.04           25.58          320914.6        437510.2 
   4.20           25.58          319275.0        435274.9 
   4.35           25.58          317751.6        433198.1 
   4.47           25.58          316663.3        431714.4 
   4.62           25.58          315316.1        429877.7 
   4.77           25.58          314055.9        428159.7 
   4.93           25.58          312874.6        426549.2 
   5.08           25.54          311764.9        425573.9 
   5.23           24.70          306967.1        429208.8 
   5.38           24.70          308693.5        431622.8 
   5.53           24.70          310325.3        433904.3 
   5.68           24.70          311885.2        436085.4 
   5.83           24.70          313349.2        438132.4 
   5.98           24.70          314739.0        440075.7 
   6.14           24.70          316074.4        441942.9 
   6.29           24.70          317331.5        443700.5 
   6.45           24.70          314385.9        439582.0 
   6.58           24.70          317462.7        443884.1 
   6.74           24.70          320997.2        448826.1 
   6.88           24.70          323810.9        452760.2 
   7.04           24.70          327049.8        457288.9 
   7.18           24.70          329632.7        460900.5 
   7.34           24.70          332599.0        465048.0 
   7.47           24.70          334978.6        468375.2 
   7.64           24.70          337727.7        472219.1 
   7.79           24.70          334622.0        467876.6 
   7.93           24.70          335145.8        468609.0 
   8.08           24.70          335662.1        469330.8 
   8.23           24.70          336148.5        470010.9 
   8.38           24.70          336628.9        470682.7 
   8.55           24.70          337161.2        471427.0 
   8.70           24.70          337606.9        472050.1 
   8.82           24.70          337963.3        472548.5 
   8.99           24.70          335303.6        468829.6 
   9.14           24.70          335754.8        469460.5 
   9.28           24.70          336191.9        470071.6 
   9.43           24.70          336615.5        470663.9 
   9.60           24.70          337095.1        471334.5 
   9.74           24.70          337491.5        471888.8 
   9.89           24.70          337876.3        472426.9 
   9.99           24.70          338123.5        472772.5 
  10.19           24.70          335761.9        469470.4 
  10.34           24.70          336129.8        469984.8 
  10.49           24.70          336478.4        470472.2 
  10.63           24.70          336826.0        470958.3 
  10.78           24.70          337164.1        471431.0 
  10.93           24.70          337484.5        471879.0 
  11.08           24.70          337804.7        472326.7 
  11.18           24.70          338007.9        472610.8 
  11.38           24.70          335862.3        469610.7 
  11.55           24.70          336288.2        470206.3 
  11.69           24.70          336636.7        470693.5 
  11.84           24.70          336976.6        471168.8 
  11.98           24.70          337308.3        471632.6 
======================================================================

Experiment report are saved in "/home/ma-user/mountdir/nni/experiments/d097Bj1h/results"

cd /home/ma-user/modelarts/user-job-dir/code/AIPerf/aiperf_ctrl/ && python3 manage.py runserver  172.16.0.62:9987 > /tmp/ctrl.log 2>&1 &

cd /home/ma-user/modelarts/user-job-dir/code/AIPerf/examples/trials/network_morphism/imagenet/ && aiperf create -c config.yml --server http://172.16.0.62:9987 > /tmp/aiperf.log 2>&1 &

            {
                "type":"eval",
                "cmd":"print(mox.file.list_directory('obs://aiperf/aiperf/code/AIPerf/aiperf_ctrl/'))"
            },
            {
                "type":"eval",
                "cmd":"print(mox.file.list_directory('/home/ma-user/modelarts/user-job-dir/code/AIPerf/aiperf_ctrl/'))"
            }


            {
                "type":"eval",
                "cmd":"mox.file.copy('obs://aiperf/aiperf/code/AIPerf/aiperf_ctrl/servers.json','/home/ma-user/modelarts/user-job-dir/code/AIPerf/aiperf_ctrl/servers.json')"
            },
            {
                "type":"bash",
                "cmd":"cat /home/ma-user/modelarts/user-job-dir/code/AIPerf/aiperf_ctrl/servers.json"
            }

            {
                "type":"eval",
                "cmd":"mox.file.copy('obs://aiperf/aiperf/code/AIPerf/aiperf_ctrl/trial/views.py','/home/ma-user/modelarts/user-job-dir/code/AIPerf/aiperf_ctrl/trial/views.py')"
            },
            {
                "type":"bash",
                "cmd":"cat /home/ma-user/modelarts/user-job-dir/code/AIPerf/aiperf_ctrl/trial/views.py"
            }

            {
                "type":"bash",
                "cmd":"cd /home/ma-user/modelarts/user-job-dir/code/AIPerf/aiperf_ctrl/ && LD_PRELOAD=/home/ma-user/miniconda3/envs/MindSpore-1.3.0-aarch64/lib/libgomp.so.1 python3 manage.py runserver  172.16.0.144:9987 > /tmp/ctrl.log 2>&1 &"
            },
            {
                "type":"bash",
                "cmd":"cat /tmp/ctrl.log"
            }

            // 启动AIPerf
            {
                "type":"bash",
                "cmd":"cd /home/ma-user/modelarts/user-job-dir/code/AIPerf/examples/trials/network_morphism/imagenet/ && LD_PRELOAD=/home/ma-user/miniconda3/envs/MindSpore-1.3.0-aarch64/lib/libgomp.so.1  TF_CPP_MIN_LOG_LEVEL=3 OBSHOME=obs://aiperf/aiperf/runlog aiperf create -c config.yml --server http://172.16.0.144:9987 > /tmp/aiperf.log 2>&1 &"
            }


            {
                "type": "eval",
                "cmd": "mox.file.copy_parallel('/dev/shm/mountdir','obs://aiperf/aiperf/runlog/mountdir')"
            },
            {
                "type": "eval",
                "cmd": "mox.file.copy_parallel('/dev/shm/nni','obs://aiperf/aiperf/runlog/nni')"
            }

            {
                "type": "eval",
                "cmd": "mox.file.copy_parallel('obs://aiperf/aiperf/code/AIPerf','/home/ma-user/modelarts/user-job-dir/code/AIPerf')"
            },
            {
                "type":"bash",
                "cmd":"cat /tmp/ctrl.log"
            }

            {
                "type": "bash",
                "cmd": "cat /home/ma-user/modelarts/user-job-dir/code/AIPerf/src/aiperf_manager/aiperf_cmd/aiperfctl.py"
            }

            {
                "type":"bash",
                "cmd":"cat /tmp/aiperf.log"
            },
            {
                "type":"bash",
                "cmd":"ps -aux | grep nni | grep -v grep | grep -v manage | awk '{print $2}' | xargs kill"
            },
            {
                "type":"bash",
                "cmd":"ps -aux | grep config.yml | grep -v grep | grep -v manage | awk '{print $2}' | xargs kill"
            }


small data : b9xLGcHV


2*8 v1:  --id fhJ0bZvt

2*8 v2: --id v984rpAE


I65yF 7806577351.0 23053452171.0
IyMFx 7806577351.0 23053452171.0
cunCX 9306884807.0 27581916187.0
SpUfA 11507559111.0 34172060591.0
s7M9h 7858760391.0 23209444271.0
Z5mF9 7858760391.0 23209444271.0

pBTrA 8155200199.0 24096076719.0
jInJx 9024924359.0 26736083995.0
yrUZT 7819623111.0 23092450223.0
6SXQV 7806577351.0 23053452171.0
JKhoU 9056762567.0 26796553135.0
wlOe5 7806577351.0 23053452171.0
M1sGF 9056762567.0 26796553135.0
vTZIU 8155200199.0 24096076719.0
JNWSb 8155200199.0 24096076719.0
x256b 8155200199.0 24096076719.0


学长，这边的情况是这样子的：第一次实验结束时的最终结果为656TFLOPs，第二次实验还在跑，测试结果为590TFLOPs，看图表还在缓慢增长中。有两个原因：
1. 昨天说的生产环境与开发环境性能差距存在且可复现，以起点Resnet50为例，开发环境平均80s/epoch, 生产环境要94s/epoch
2. 我仔细看了log，第一次实验的过程中很意外的突然生成了两个较大的网络...而机器目前看来对网络大小并不敏感，导致得分被拉上去了
第一个我一会可以去群里问一下，第二个我不太清楚好不好跟他们解释

这边有个问题需要解决一下，我们仔细看了一下实验日志，发现生产环境和调试环境的训练效率有比较明显的差距：以初始的ResNet50为例，在调试环境上平均每个Epoch稳定在80秒左右，在实验环境上这个时间要93-94秒，因为加速卡是一样的，我们怀疑是不是磁盘或者卡间通信效率存在差异，这个会对后面的实验结果产生比较大的影响


另外，有关性能目标那块，我的想法是这样子的：我们之前单机测试的结果是337，换好超参数之后我预计能做到350，然后乘上两边性能差异的比（82/94）,那么这边的目标就在305左右，双机610。目前15h的结果是595，还在缓慢增长，这个目标我觉得是有希望的

 {
                "type": "bash",
                "cmd": "cd /home/ma-user/modelarts/user-job-dir/code/AIPerf/examples/trials/network_morphism/imagenet/ && unset RANK_TABLE_FILE &&  LD_PRELOAD=/home/ma-user/miniconda3/envs/MindSpore-1.3.0-aarch64/lib/libgomp.so.1 GLOG_v=1 MINDSPORE_HCCL_CONFIG_PATH=/home/ma-user/modelarts/user-job-dir/code/AIPerf/hccl.json SIZE_LIMIT=28 NPU_NUM=8 python3 multithread_demo.py  --batch_size 256  --epoch 15  --train_data_dir /home/ma-user/modelarts/inputs/data_1/train/  --val_data_dir /home/ma-user/modelarts/inputs/data_1/val/ > /tmp/stdout.log 2>/tmp/stderr.log"
            }